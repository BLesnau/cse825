<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

    <title>Man-In-The-Middle Attacks</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    ee
    <link href="css/site.css" rel="stylesheet">
</head>

<body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" style="font-weight: bolder; color: #00AA8C" href="home.html">Man-In-The-Middle Attacks</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="home.html">Home</a></li>
                    <li class="active dropdown"><a class="dropdown-toggle" data-toggle="dropdown">Homework <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="vmware.html">VMWare Player Setup</a></li>
                            <li><a href="vbox.html">VirtualBox Setup</a></li>
                            <li class="active"><a href="homework1.html">Part 1: Starbucks Hates You</a></li>
                            <li><a href="homework2.html">Part 2: Chrome Extension</a></li>
                            <li><a href="deliverables.html">Devliverables</a></li>
                        </ul>
                    </li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="starter-template">
            <h2 style="text-decoration: underline">Homework Part 1: Becoming Dangerous at Starbucks</h2>
            <br />

            <h3><b>The Goal</b></h3>
            <p>
                For this part of the homework we will be looking at a man-in-the middle attack involving the intecepting
                and sniffing of HTTP packets that were not originally meant for you. By making use of a sniffing tool combined
                with what is known as an ARP attack, we can both intercept and read packets that were meant for a different
                machine on the network. After you are done reading these packets you can forward them to the intended machine
                leaving the victim none the wiser.
            </p>

            <br />

            <h3><b>Getting Started</b></h3>
            <p>
                You will first need to get your Kali Linux virtual machine setup. We have directions for using <a href="vmware.html">VMWare Player</a> and <a href="vbox.html">VirtualBox</a>.
            </p>

            <br />

            <h3><b>Traffic Sniffing</b></h3>
            <p>
                For this part of the homework, you will monitor different types of network traffic and report what you see. 
                You will use the "wget" command to download some apps that we have created for you to use, so just make sure 
                that you are downloading them into the directory that you want.
            </p>
            <ol>
                <li>
                    <p>Run Wireshark during these sniffing exercises.</p>
                </li>
            </ol>
            <p>It can be found under Applications -> Kali Linux -> Sniffing/Spoofing -> Network Sniffers -> wireshark.</p>
            <img src="images/wireshark.png" width="60%" />
            <br />
            <br />
            <p>
                You may get some errors about certain libraries failing to load or warnings about sniffing while being root
                but these can be ignored.
            </p>
            <ol start="2">
                <li>
                    <p>Select the network "eth0" which is the main ethernet network for the VM and click "Start"</p>
                </li>
            </ol>
            <img src="images/start-sniffing.png" width="60%" />
            <br />
            <br />
            <p>
                You can filter what you see in Wireshark by using the filter field near the top of the application. You can 
                type into it manually or right click on items in the list and add filters based on them. For example, it will 
                be useful to filter by IP for this part of the homework.
            </p>

            <br />

            <p><u><b>TCP Sniffing</b></u></p>
            <p>TCP sniffing will allow you to see low level individual packets that are being sent across a network.</p>
            <ol start="3">
                <li>
                    <p>Run "wget http://mitm.azurewebsites.net/AzureSite/files/tcp_client.bin"</p>
                </li>
                <li>
                    <p>Run "tcp_client". This will send TCP traffic for you to monitor.</p>
                </li>
                <li>
                    <p>Observe the traffic in Wireshark and report the application data that you see being sent and received</p>
                </li>
            </ol>
            <br />
            <p><u><b>HTTP Sniffing</b></u></p>
            <p>HTTP sniffing will allow you to see higher level web requests being sent across a network. Under the hood, each of these HTTP requests is made up of multple TCP packets.</p>
            <ol start="6">
                <li>
                    <p>Run "wget http://mitm.azurewebsites.net/AzureSite/files/http_client.bin"</p>
                </li>
                <li>
                    <p>Run "http_client". This will send HTTP traffic for you to monitor.</p>
                </li>
                <li>
                    <p>Observe the traffic in Wireshark and report the application data that you see being sent and received</p>
                </li>
            </ol>
            <br />
            <p><u><b>HTTPS Sniffing</b></u></p>
            <p>HTTPS sniffing will allow you to see higher level web requests similar to HTTP requests. The requests payload in these cases are considered secure and will appear encrypted.</p>
            <ol start="9">
                <li>
                    <p>Run "wget http://mitm.azurewebsites.net/AzureSite/files/https_client.bin"</p>
                </li>
                <li>
                    <p>Run "https_client". This will send HTTPS traffic for you to monitor.</p>
                </li>
                <li>
                    <p>Observe the traffic in Wireshark and report the application data that you see being sent and received</p>
                </li>
            </ol>

            <br />

            <h3><b>OpenSSL</b></h3>
            <p>
                For this part of the homework, you will be looking at how OpenSSL is setup on a Linux server 
                that we have created. You will then establish a connection with that server based on the 
                information that you find. The server's IP address is 138.91.119.153.
            </p>
            <ol start="12">
                <li>
                    <p>Run "<a href="http://man.cx/sslscan(1)">sslscan</a>" on the server.</p>
                </li>
                <li>
                    <p>What is the lowest version of SSL supported by the server?</p>
                </li>
                <li>
                    <p>What are the server's preferred ciphers?</p>
                </li>
                <li>
                    <p>Use "<a href="http://man.cx/openssl">openssl</a>" to establish a connection with our server using the preferred SSL cipher. Use Wireshark to capture this activity.</p>
                </li>
                <li>
                    <p>
                        Turn in a screenshot of the "Client Hello" request with the "Cipher Suites" section expanded under the "Scure Sockets Layer". 
                        You can get to this information by double-clicking the message that you want to look at.
                    </p>
                </li>
                <li>
                    <p>What was the "openssl" command that you used?</p>
                </li>
            </ol>

            <br />

            <h3><b>SSL DOS</b></h3>
            <p>Some stuff will go here</p>

            <p>
                For this part of the homework, you will be performing SSL DOS attacks on two different servers. The insecure server allows insecure 
                renegotiation and the secure server does not allow it. Their IP addresses are as follows:
            </p>
            <ul>
                <li>Insecure Server: 137.117.84.81</li>
                <li>Secure Server: 138.91.119.153</li>
            </ul>
            <br />
            <p><u><b>Insecure Renegotion Allowed</b></u></p>
            <ol start="18">
                <li>
                    <p>What version of OpenSSL is running on the insecure server?</p>
                </li>
            </ol>
            <p>
                Hint: Use "openssl" similar to how you did above in the OpenSSL section, but perform a GET request on the webpage. Make sure that you find the OpenSSL 
                version, not the SSL version.
            </p>
            <ol start="19">
                <li>
                    <p>Navigate to the insecure server's HTTPS webpage (https://137.117.84.81) and observe what it looks like and how it loads.</p>
                </li>
                <li>
                    <p>Use "<a href="https://www.thc.org/thc-ssl-dos/">thc-ssl-dos</a>" to perform an SSL DOS attack on the insecure server. This is already installed in the Kali VM.</p>
                </li>
                <li>
                    <p>What is the max number of connections that you see?</p>
                </li>
                <li>
                    <p>Navigate back to the insecure server's webpage and observe how it behaves now. Take a screenshot of what it looks like. Be patient. It may take longer this time to load.</p>
                </li>
                <li>
                    <p>What was the command that you used to perform this attack?</p>
                </li>
            </ol>
            <p>Make sure that you close the "thc-ssl-dos" application so that others can continue to perform the attack.</p>
            <br />
            <p><u><b>Insecure Renegotion Disabled</b></u></p>
            <ol start="24">
                <li>
                    <p>Perform an SSL DOS attack on the secure server</p>
                </li>
            </ol>
            <p>
                Hint: Remember that insecure renegotiation is not allowed on the secure server. The previous attack will not work since renegotions 
                will not occur repeatedly for the same connection. You will need to write a script that opens many secure connections with the server.
                Use the command that you used for the insecure server as a starting point and open the connections in parallel.
            </p>
            <p>
                Bash script <a href="http://www.cyberciti.biz/faq/bash-for-loop/">loops</a> and <a href="http://www.symkat.com/understanding-job-control-in-bash">background jobs</a> may help you out.
            </p>
            <p>You can view the current total percent of current CPU usage here to see if your attack is working: <a href="http://138.91.119.153/cpu.txt">http://138.91.119.153/cpu.txt</a></p>
            <ol start="25">
                <li>
                    <p>Turn in the script that you used to perform the attack on the secure server.</p>
                </li>
            </ol>
            <p>Once again, make sure that you close the "thc-ssl-dos" application so that others can continue to perform the attack.</p>
            <br />
            <p><u><b>Are Secure Sites That You Use Suseptible to SSL DOS Attacks?</b></u></p>
            <ol start="26">
                <li>
                    <p>Check three secure (HTTPS) sites that you use to see if insecure renogitation is allowed.</p>
                </li>
            </ol>
            <p>
                After connection with "openssl", type "R" and hit Enter. If insecure renegotiation is enabled, you will see a new certificate being issued. 
                If insecure renegotiation is disabled, you will see an error.
            </p>
            <ol start="27">
                <li>
                    <p>Report which websites you tested and whether insecure renegotiation was enabled or disabled.</p>
                </li>
            </ol>

            <br />

            <h3><b>SSL Stripping</b></h3>
            <p>
                For this part of the homework, you will be using "sslstrip" to "strip" out anything that makes an HTTPS request secure so that you can 
                see the payload inside of it. The request can then be forwarded on as an HTTP request.
            </p>
            <ol start="28">
                <li>On your host computer (The computer that is running VirtualBox or VMWare), take a screenshot of the secure connection information for an 
                    HTTPS webpage. In Chrome, you can click the lock on the left side of the address bar.
                </li>
            </ol>
            <br />
            <img src="images/secure-facebook.png" width="50%" />
            <br />
            <br />
            <ol start="29">
                <li>
                    <p>
                        Run "<a href="http://manpages.ubuntu.com/manpages/oneiric/man1/sslstrip.1.html">sslstrip</a>" simlar to how it was demoed in class. Forward TCP transactions from port 80 to port 1234.
                    </p>
                </li>
                <li>
                    <p>
                        On your host computer, navigate to a secure webpage such as the one you navigated to in step 24. Take a screenshot of the website's secure connection information now.
                    </p>
                </li>
                <li>
                    <p>
                        Attempt to login to that website and observe what is output to your sslstrip.log in the Kali virtual machine. Take a screenshot or report the text inside of that log file. 
                        You may not want to use real credentials when attempting to login.
                    </p>
                </li>
            </ol>
            <p>
                You will need to know your host computer's IP address (according to your Kali VM) as well as the server address. (This is basically acting as the router's address if you were attacking someone's computer on a 
                public wifi network). You can find the IP address of your host computer by looking at the IP address shown in Wireshark while your host computer is performing some web activity. 
                You can find your server (router) address by using the route -n command.
            </p>

            <p>
                If you are having trouble getting things to work or seeing strange behavior, try restarting your Kali virtual machine and/or clearing your recent browsing history on your host computer. 
                ARP spoofing can sometimes get things into a weird state and something needs to be reset.
            </p>

            <br />

            <h3><b>TLS Renegotiation</b></h3>
            <p>Some stuff will go here</p>

            <br />

            <h3><b>Part [TODO] Deliverables</b></h3>
            <ul>
                <li>[TODO]</li>
            </ul>
        </div>
    </div>
    <!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
